# CloudVar Client SDK API

CloudVar クライアント SDK の内部構造と、JavaScript からの操作方法について説明します。

## 核心コンセプト: Proxy 同期

CloudVar は `Proxy` オブジェクトを使用して、変数の代入をフックしています。

```javascript
const cv = new CloudVar('ws://localhost:5032');

// この代入は Proxy によってキャッチされ、自動的にネットワーク送信されます
score = 100; 
```

### なぜ `cv.score` ではなく `score` で動くのか？

CloudVar は起動時に HTML（`cv-bind` 等）をスキャンし、見つかった変数名を `window` オブジェクトの Getter/Setter として登録します。これにより、グローバル変数を操作するだけで CloudVar の同期エンジンが作動します。

## メソッド一覧

### `new CloudVar(url, options)`
インスタンスを作成し、サーバーへ接続します。
- `url`: WebSocketサーバーのURL
- `options.room`: 参加するルーム名

### `cv.onChange(key, callback)`
変数が更新された時に実行されるリスナーを登録します。
- `key`: 変数名。`'*'` を指定すると全ての更新を監視します。
- `callback`: `(value) => { ... }` または `'*'` の場合は `(key, value) => { ... }`

### `cv.varList`
現在クラウド同期されている変数名の一覧（配列）を返します。

### `cv.unSync(key)`
指定した変数のクラウド同期を停止します。
- 以降、その変数への代入はサーバーへ送信されなくなります。
- ただし、DOMとの同期（`cv-bind`等）は引き続きローカルで機能します。

## 内部・高度な操作

### `_set(key, value)`
同期エンジンを直接呼び出します。通常、ユーザーがこれを使う必要はありませんが、`Proxy` を介さない内部モジュール（Binding等）から同期を行いたい場合に役立ちます。

### `_rawVars`
現在同期されている変数の生の値を保持するオブジェクトです。ここを直接書き換えても **同期は行われません**。

## トラブルシューティング

### 変数が同期されない
1. **HTMLに存在するか**: `cv-bind` 等で一度も使われていない変数は、自動的にグローバルに紐付きません。その場合は最初に一度だけ `cv.myVar = 0;` のように `cv.` を付けて代入してください。
2. **既存のグローバル変数**: `name` や `location` などのブラウザ標準の変数名を使うと、競合が発生する場合があります。可能な限り固有の名前（`userNickname` 等）を使用してください。