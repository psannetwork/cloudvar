<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>CloudVar - System Magic Chips</title>
    <style>
        body { font-family: 'Courier New', Courier, monospace; background: #000; color: #0f0; padding: 20px; line-height: 1.4; }
        .dashboard { border: 1px solid #0f0; padding: 20px; margin-bottom: 20px; background: #020; }
        .log-area { height: 300px; overflow-y: auto; border: 1px solid #0f0; padding: 10px; background: #000; white-space: pre-wrap; font-size: 0.9em; }
        .magic-btn { background: #0f0; color: #000; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; margin: 5px; }
        .magic-btn:hover { background: #0a0; }
        .label { color: #8f8; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ›° SYSTEM DASHBOARD</h1>
    
    <div class="dashboard">
        <div><span class="label">MY_ID:</span> <span cv-bind="myID">å–å¾—ä¸­...</span></div>
        <div><span class="label">ROOM:</span> <span cv-bind="roomName">---</span></div>
        <div><span class="label">ONLINE:</span> <span cv-bind="userCount">0</span> äººã®ãƒ’ãƒ¼ãƒ­ãƒ¼ãŒæ¥ç¶šä¸­</div>
        <div><span class="label">LAST_ACTION:</span> <span cv-bind="lastTime">ãªã—</span></div>
    </div>

    <div class="log-area" cv-bind="systemLog">ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°å¾…æ©Ÿä¸­...</div>

    <div style="margin-top: 20px;">
        <!-- å‘½ä»¤ãƒãƒƒãƒ— (ALERT, LOG) ã¨å€¤ãƒãƒƒãƒ— (ID, TIME, BR) ã®çµ„ã¿åˆã‚ã› -->
        <button class="magic-btn" cv-on="click: systemLog += '[' + TIME + '] ' + ID + ' ãŒã‚·ã‚°ãƒŠãƒ«ã‚’é€ä¿¡' + BR; lastTime = TIME; LOG('Signal sent by ' + ID)">
            ã‚·ã‚°ãƒŠãƒ«ã‚’é€ä¿¡ (LOG)
        </button>
        
        <button class="magic-btn" cv-on="click: ALERT('ã‚ãªãŸã®IDã¯ ' + ID + ' ã§ã™ã€‚ç¾åœ¨ ' + COUNT + ' äººãŒã“ã®éƒ¨å±‹ã«ã„ã¾ã™ã€‚')">
            ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª (ALERT)
        </button>
    </div>

    <script src="../cloudvar.js"></script>
    <script>
        // æ¥ç¶š
        const cv = new CloudVar('wss://cloudvar.psannetwork.net', { room: 'magic-system-demo' });

        // ãƒãƒƒãƒ—ã®å€¤ã‚’å®šæœŸçš„ã«åæ˜ ã•ã›ã‚‹ï¼ˆæ¥ç¶šå®Œäº†ã‚’å¾…ã£ã¦ã‹ã‚‰ï¼‰
        cv.onChange('_joined', () => {
            myID = cv.id;
            roomName = cv.roomId;
            systemLog = systemLog || "--- LOG START ---" + BR;
        });

        // æ¥ç¶šäººæ•°ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
        const updateStats = () => {
            userCount = cv.clientList.length;
        };
        cv.onChange('_client_join', updateStats);
        cv.onChange('_client_leave', updateStats);
        cv.onChange('_joined', updateStats);
    </script>
</body>
</html>
